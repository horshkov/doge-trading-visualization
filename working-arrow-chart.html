<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOGE Trading Chart - Working Arrow Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(180deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #1d1d1f;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            padding: 40px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #1d1d1f;
            margin-bottom: 12px;
            font-size: 2.75rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            line-height: 1.1;
        }
        
        .header p {
            color: #86868b;
            font-size: 1.1rem;
            font-weight: 400;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        .info-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .info-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }
        
        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }
        
        .info-card.target { 
            border-left: 4px solid #ff3b30;
        }
        .info-card.resolution { 
            border-left: 4px solid #ff9500;
        }
        .info-card { 
            border-left: 4px solid #30d158;
        }
        .info-card.trades { 
            border-left: 4px solid #007aff;
        }
        
        .info-card strong {
            font-size: 1.1rem;
            font-weight: 600;
            display: block;
            margin-bottom: 8px;
            letter-spacing: -0.01em;
        }
        
        .info-card span {
            font-size: 1.5rem;
            font-weight: 500;
            color: #1d1d1f;
        }
        
        .target { color: #ff3b30; }
        .resolution { color: #ff9500; }
        .result { color: #30d158; }
        .trades { color: #007aff; }
        .chart-container {
            position: relative;
            width: 100%;
            height: 700px;
            margin-bottom: 32px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .legend-section {
            background: rgba(248, 249, 250, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
        }
        
        .legend-section h4 {
            margin: 0 0 20px 0;
            color: #1d1d1f;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }
        
        .legend-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease;
        }
        
        .legend-item:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
        }
        
        .legend-symbol {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            font-size: 16px;
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .buy-yes { background: linear-gradient(135deg, #30d158, #28cd41); }
        .sell-yes { background: linear-gradient(135deg, #ff3b30, #d70015); }
        .buy-no { background: linear-gradient(135deg, #30d158, #28cd41); }
        .sell-no { background: linear-gradient(135deg, #ff3b30, #d70015); }
        
        .price-line-legend { 
            background: linear-gradient(135deg, #30d158, #28cd41);
            height: 4px; 
            border-radius: 2px; 
            width: 28px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .target-line-legend { 
            background: #ff3b30;
            height: 2px; 
            border-radius: 1px; 
            width: 28px;
            border: 1px dashed #ff3b30;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        .trade-summary {
            background: rgba(248, 249, 250, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 32px;
            border-radius: 20px;
            margin-top: 32px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }
        
        .trade-summary h3 {
            color: #1d1d1f;
            margin-top: 0;
            margin-bottom: 24px;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }
        
        .trade-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 28px 0;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }
        
        .stat-item .number {
            font-size: 2rem;
            font-weight: 700;
            color: #007aff;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }
        
        .stat-item .label {
            color: #86868b;
            font-size: 0.9rem;
            font-weight: 500;
            line-height: 1.3;
        }
        
        .highlight-box {
            background: rgba(255, 204, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 204, 0, 0.3);
            padding: 24px;
            border-radius: 16px;
            margin: 24px 0;
            box-shadow: 0 4px 16px rgba(255, 204, 0, 0.1);
        }
        
        .highlight-box strong {
            color: #1d1d1f;
            font-weight: 600;
        }
        
        .highlight-box ul {
            margin: 16px 0 0 0;
            padding-left: 20px;
        }
        
        .highlight-box li {
            color: #1d1d1f;
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .time-controls {
            background: rgba(248, 249, 250, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 32px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        }
        
        .time-controls h4 {
            margin: 0 0 24px 0;
            color: #1d1d1f;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 600;
            letter-spacing: -0.01em;
        }
        
        .preset-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 28px;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            padding: 12px 24px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #007aff;
            border-radius: 22px;
            cursor: pointer;
            font-weight: 500;
            font-size: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 122, 255, 0.2);
        }
        
        .preset-btn:hover {
            background: rgba(0, 122, 255, 0.1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }
        
        .preset-btn.active {
            background: #007aff;
            color: white;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
            transform: translateY(-1px);
        }
        
        .time-navigator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .nav-btn {
            padding: 12px 20px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #86868b;
            border-radius: 20px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(134, 134, 139, 0.2);
        }
        
        .nav-btn:hover:not(:disabled) {
            background: rgba(134, 134, 139, 0.1);
            color: #1d1d1f;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }
        
        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }
        
        .time-display {
            background: linear-gradient(135deg, #007aff, #0056d6);
            color: white;
            padding: 12px 24px;
            border-radius: 20px;
            font-weight: 600;
            min-width: 240px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
            font-size: 15px;
            letter-spacing: -0.01em;
        }
        
        .time-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }
        
        .time-info-item {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease;
        }
        
        .time-info-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .time-info-item .label {
            font-size: 0.85rem;
            color: #86868b;
            margin-bottom: 6px;
            font-weight: 400;
            letter-spacing: -0.01em;
        }
        
        .time-info-item .value {
            font-weight: 600;
            color: #007aff;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêï DOGE Trading Analysis - High-Frequency Visualization</h1>
            <p>All 88 trades with 5-second price resolution and directional arrows</p>
            <p><strong>August 13, 2025 ‚Ä¢ 16:00-17:00 UTC ‚Ä¢ 721 Price Points</strong></p>
        </div>

        <div class="info-cards">
            <div class="info-card target">
                <strong class="target">üéØ Target Price</strong>
                <span>$0.24072</span>
            </div>
            <div class="info-card resolution">
                <strong class="resolution">üìä Resolution</strong>
                <span>$0.241238</span>
            </div>
            <div class="info-card">
                <strong class="result">‚úÖ Result</strong>
                <span>YES WINS!</span>
            </div>
            <div class="info-card trades">
                <strong class="trades">üìà Total Trades</strong>
                <span>88 trades mapped</span>
            </div>
        </div>

        <div class="time-controls">
            <h4>‚è±Ô∏è Time Controls</h4>
            
            <div class="preset-buttons">
                <button class="preset-btn active" onclick="setTimePreset('1h')">1 Hour (Full)</button>
                <button class="preset-btn" onclick="setTimePreset('30min')">30 Minutes</button>
                <button class="preset-btn" onclick="setTimePreset('5min')">5 Minutes</button>
            </div>
            
            <div class="time-navigator">
                <button class="nav-btn" id="prevBtn" onclick="navigateTime(-1)">‚óÄ Previous</button>
                <div class="time-display" id="timeDisplay">16:00 - 17:00 UTC (Full Hour)</div>
                <button class="nav-btn" id="nextBtn" onclick="navigateTime(1)">Next ‚ñ∂</button>
            </div>
            
            <div class="time-info">
                <div class="time-info-item">
                    <div class="label">Current Interval</div>
                    <div class="value" id="currentInterval">60 minutes</div>
                </div>
                <div class="time-info-item">
                    <div class="label">Trades Visible</div>
                    <div class="value" id="tradesVisible">88</div>
                </div>
                <div class="time-info-item">
                    <div class="label">Price Range</div>
                    <div class="value" id="priceRangeDisplay">Loading...</div>
                </div>
                <div class="time-info-item">
                    <div class="label">Navigation</div>
                    <div class="value" id="navigationInfo">1 of 1</div>
                </div>
                <div class="time-info-item">
                    <div class="label">Scale Mode</div>
                    <div class="value" id="scaleMode">Adaptive</div>
                </div>
                <div class="time-info-item">
                    <div class="label">Y-Axis Range</div>
                    <div class="value" id="yAxisRange">Auto</div>
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-section">
                <h4>üéØ Trade Direction & Strategy</h4>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-symbol buy-yes">‚Üë</div>
                        <span><strong>BUY YES</strong><br>Green ‚Üë</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-symbol sell-yes">‚Üë</div>
                        <span><strong>SELL YES</strong><br>Red ‚Üë</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-symbol buy-no">‚Üì</div>
                        <span><strong>BUY NO</strong><br>Green ‚Üì</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-symbol sell-no">‚Üì</div>
                        <span><strong>SELL NO</strong><br>Red ‚Üì</span>
                    </div>
                </div>
            </div>
            <div class="legend-section">
                <h4>üìä Chart Elements</h4>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="price-line-legend"></div>
                        <span>DOGE Price Line</span>
                    </div>
                    <div class="legend-item">
                        <div class="target-line-legend"></div>
                        <span>Target ($0.24072)</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="workingArrowChart"></canvas>
        </div>

        <div class="trade-summary">
            <h3>üìä Arrow-Based Trading Analysis</h3>
            
            <div class="trade-stats">
                <div class="stat-item">
                    <div class="number" id="buyYesCount">0</div>
                    <div class="label">BUY YES (Green ‚Üë)</div>
                </div>
                <div class="stat-item">
                    <div class="number" id="sellYesCount">0</div>
                    <div class="label">SELL YES (Red ‚Üë)</div>
                </div>
                <div class="stat-item">
                    <div class="number" id="buyNoCount">0</div>
                    <div class="label">BUY NO (Green ‚Üì)</div>
                </div>
                <div class="stat-item">
                    <div class="number" id="sellNoCount">0</div>
                    <div class="label">SELL NO (Red ‚Üì)</div>
                </div>
            </div>

            <div class="highlight-box">
                <strong>üöÄ High-Frequency Features:</strong>
                <ul>
                    <li><strong>5-Second Resolution:</strong> 721 price data points with micro-fluctuations for ultra-smooth visualization</li>
                    <li><strong>Adaptive Time Labels:</strong> X-axis shows seconds (HH:mm:ss) for 5-minute views, minutes for longer periods</li>
                    <li><strong>Multi-Resolution Views:</strong> 1 Hour (5min labels), 30 Minutes (2min labels), 5 Minutes (30sec labels)</li>
                    <li><strong>Dynamic Scaling:</strong> Y-axis automatically adjusts for optimal detail at each timeframe</li>
                    <li><strong>Smart Navigation:</strong> Navigate through high-frequency periods with responsive tooltips</li>
                    <li><strong>Precision Trading:</strong> All 88 trade arrows positioned exactly on high-resolution price curve</li>
                </ul>
            </div>

            <p><strong>Scale Behavior:</strong></p>
            <ul>
                <li><strong>1 Hour View:</strong> Overview scale with 15% padding - shows full price movement range</li>
                <li><strong>30 Minute View:</strong> Detailed scale with 25% padding - enhanced price detail for half-hour periods</li>
                <li><strong>5 Minute View:</strong> Precision scale with 40% padding - maximum detail for granular analysis</li>
                <li><strong>Auto-Adjustment:</strong> Y-axis automatically zooms to the price range of visible data</li>
                <li><strong>Smart X-Axis:</strong> Time labels adjust density based on timeframe (10min/5min/1min intervals)</li>
            </ul>
        </div>
    </div>

    <script>
        // All trades data
        const allTrades = [
            { time: '16:03:29', contracts: 2.0, direction: 'YES', strategy: 'BUY', trader: 'Tlingg', size: 'small' },
            { time: '16:04:25', contracts: 4.0, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:04:47', contracts: 33.7, direction: 'NO', strategy: 'BUY', trader: 'EL CERTIFIED', size: 'medium' },
            { time: '16:05:19', contracts: 25.6, direction: 'YES', strategy: 'BUY', trader: '0x213f...A08E', size: 'medium' },
            { time: '16:05:27', contracts: 10.5, direction: 'YES', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:05:41', contracts: 10.5, direction: 'YES', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:05:43', contracts: 2.2, direction: 'YES', strategy: 'BUY', trader: '0xDc0e...8530', size: 'small' },
            { time: '16:05:53', contracts: 10.3, direction: 'YES', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:06:07', contracts: 4.0, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:08:21', contracts: 10.3, direction: 'YES', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:09:35', contracts: 31.8, direction: 'NO', strategy: 'BUY', trader: 'ChaJungKyu', size: 'medium' },
            { time: '16:09:57', contracts: 19.5, direction: 'NO', strategy: 'BUY', trader: '0x034C...6B6A', size: 'small' },
            { time: '16:10:59', contracts: 1.9, direction: 'YES', strategy: 'BUY', trader: 'Jiwoin', size: 'small' },
            { time: '16:11:13', contracts: 3.7, direction: 'YES', strategy: 'BUY', trader: 'Tiep05', size: 'small' },
            { time: '16:11:39', contracts: 16.2, direction: 'YES', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:15:41', contracts: 28.0, direction: 'NO', strategy: 'BUY', trader: '0x8074...8a79', size: 'medium' },
            { time: '16:16:37', contracts: 18.5, direction: 'YES', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:17:27', contracts: 57.6, direction: 'YES', strategy: 'BUY', trader: 'Crypto Tariqul', size: 'medium' },
            { time: '16:17:57', contracts: 34.7, direction: 'YES', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:18:33', contracts: 11.6, direction: 'YES', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:19:29', contracts: 11.6, direction: 'YES', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:23:41', contracts: 0.2, direction: 'YES', strategy: 'BUY', trader: 'Coraline', size: 'small' },
            { time: '16:23:47', contracts: 15.8, direction: 'YES', strategy: 'BUY', trader: '0x6f57...Ad64', size: 'small' },
            { time: '16:24:37', contracts: 9.9, direction: 'YES', strategy: 'BUY', trader: '0x64bA...4c8a', size: 'small' },
            { time: '16:30:11', contracts: 10.1, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:30:31', contracts: 10.1, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:30:37', contracts: 9.0, direction: 'YES', strategy: 'BUY', trader: '0x8a1F...91c7', size: 'small' },
            { time: '16:30:49', contracts: 11.0, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:31:11', contracts: 2.1, direction: 'NO', strategy: 'BUY', trader: 'Tlingg', size: 'small' },
            { time: '16:31:59', contracts: 4.0, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:32:09', contracts: 9.3, direction: 'NO', strategy: 'BUY', trader: 'bliss', size: 'small' },
            { time: '16:33:03', contracts: 3.7, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:34:01', contracts: 11.3, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:37:15', contracts: 1.9, direction: 'YES', strategy: 'BUY', trader: 'Tlingg', size: 'small' },
            { time: '16:37:15', contracts: 17.5, direction: 'YES', strategy: 'BUY', trader: '0x4d60...e830', size: 'small' },
            { time: '16:38:01', contracts: 0.2, direction: 'YES', strategy: 'BUY', trader: '0xD067...76f8', size: 'small' },
            { time: '16:38:29', contracts: 67.5, direction: 'YES', strategy: 'BUY', trader: '0x4d60...e830', size: 'large' },
            { time: '16:39:09', contracts: 0.1, direction: 'YES', strategy: 'BUY', trader: 'SATOSHIANAKONDO', size: 'small' },
            { time: '16:39:33', contracts: 25.7, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:40:05', contracts: 25.7, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:40:49', contracts: 34.6, direction: 'YES', strategy: 'BUY', trader: '0x59c5...9ae4', size: 'medium' },
            { time: '16:41:03', contracts: 36.6, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:42:01', contracts: 36.6, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:43:11', contracts: 27.5, direction: 'YES', strategy: 'BUY', trader: '0x7079...6643', size: 'medium' },
            { time: '16:43:17', contracts: 1.1, direction: 'YES', strategy: 'BUY', trader: '0xE6d7...0d0a', size: 'small' },
            { time: '16:44:11', contracts: 1.2, direction: 'NO', strategy: 'BUY', trader: 'Mrravaleth', size: 'small' },
            { time: '16:44:47', contracts: 10.8, direction: 'YES', strategy: 'BUY', trader: 'Rogue', size: 'small' },
            { time: '16:45:27', contracts: 21.4, direction: 'YES', strategy: 'BUY', trader: 'letsgo', size: 'small' },
            { time: '16:46:07', contracts: 4.2, direction: 'YES', strategy: 'BUY', trader: '0xFEc4...Fec0', size: 'small' },
            { time: '16:46:09', contracts: 56.2, direction: 'YES', strategy: 'SELL', trader: 'Crypto Tariqul', size: 'medium' },
            { time: '16:47:29', contracts: 220.6, direction: 'YES', strategy: 'BUY', trader: 'Kryptdip', size: 'huge' },
            { time: '16:48:19', contracts: 46.3, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:48:37', contracts: 36.2, direction: 'NO', strategy: 'BUY', trader: '0xddCa...5E34', size: 'medium' },
            { time: '16:48:57', contracts: 105.3, direction: 'NO', strategy: 'BUY', trader: '0xht9', size: 'large' },
            { time: '16:48:59', contracts: 18.8, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:49:15', contracts: 27.5, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:49:47', contracts: 50.1, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:50:15', contracts: 32.0, direction: 'YES', strategy: 'BUY', trader: '0xddCa...5E34', size: 'medium' },
            { time: '16:50:57', contracts: 43.8, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:51:15', contracts: 44.0, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:52:27', contracts: 49.8, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:53:31', contracts: 24.3, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:53:43', contracts: 77.6, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'large' },
            { time: '16:53:59', contracts: 42.8, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:54:13', contracts: 28.2, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:54:39', contracts: 20.7, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'small' },
            { time: '16:54:57', contracts: 25.7, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:55:33', contracts: 6.2, direction: 'YES', strategy: 'BUY', trader: '0xDd36...624f', size: 'small' },
            { time: '16:55:49', contracts: 33.5, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'medium' },
            { time: '16:56:35', contracts: 2.3, direction: 'YES', strategy: 'BUY', trader: '0x2b2c...75d3', size: 'small' },
            { time: '16:56:37', contracts: 22.3, direction: 'YES', strategy: 'BUY', trader: '0xA91f...A2Cb', size: 'small' },
            { time: '16:57:19', contracts: 134.4, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'huge' },
            { time: '16:57:35', contracts: 107.4, direction: 'NO', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'large' },
            { time: '16:57:49', contracts: 26.4, direction: 'YES', strategy: 'BUY', trader: '0xB650...445f', size: 'medium' },
            { time: '16:58:47', contracts: 107.4, direction: 'NO', strategy: 'SELL', trader: '0x3f45...C6EC', size: 'large' },
            { time: '16:59:11', contracts: 21.4, direction: 'YES', strategy: 'BUY', trader: '0xDc0e...8530', size: 'small' },
            { time: '16:59:13', contracts: 22.2, direction: 'YES', strategy: 'SELL', trader: '0xA91f...A2Cb', size: 'small' },
            { time: '16:59:13', contracts: 35.6, direction: 'NO', strategy: 'SELL', trader: '0xddCa...5E34', size: 'medium' },
            { time: '16:59:19', contracts: 11.5, direction: 'YES', strategy: 'BUY', trader: 'Tlingg', size: 'small' },
            { time: '16:59:29', contracts: 199.8, direction: 'YES', strategy: 'BUY', trader: 'PHILARMONIA', size: 'huge' },
            { time: '16:59:37', contracts: 281.7, direction: 'YES', strategy: 'BUY', trader: '0x8e8A...1845', size: 'huge' },
            { time: '16:59:43', contracts: 36.4, direction: 'YES', strategy: 'BUY', trader: '0x6e82...e82F', size: 'medium' },
            { time: '16:59:47', contracts: 29.2, direction: 'NO', strategy: 'BUY', trader: 'Tlingg', size: 'medium' },
            { time: '16:59:53', contracts: 188.3, direction: 'YES', strategy: 'BUY', trader: '0xDc0e...8530', size: 'huge' },
            { time: '16:59:53', contracts: 108.1, direction: 'YES', strategy: 'BUY', trader: 'siqhenz', size: 'large' },
            { time: '16:59:55', contracts: 571.2, direction: 'YES', strategy: 'BUY', trader: 'Rogue', size: 'legendary' },
            { time: '17:00:01', contracts: 9.8, direction: 'YES', strategy: 'BUY', trader: 'JAHAN ALVEE', size: 'small' },
            { time: '17:00:07', contracts: 132.5, direction: 'YES', strategy: 'BUY', trader: '0x3f45...C6EC', size: 'huge' }
        ];

        // Generate dual-resolution price data
        function generatePriceData() {
            const data = {
                minuteData: [],
                highFreqData: []
            };
            const startTime = new Date('2025-08-13T16:00:00Z');
            const targetPrice = 0.24072;
            
            const knownPoints = [
                { minute: 3, price: 0.241441 },
                { minute: 20, price: 0.242000 },
                { minute: 43, price: 0.242606 },
                { minute: 47, price: 0.241832 },
                { minute: 49, price: 0.241990 },
                { minute: 60, price: 0.241489 }
            ];
            
            // Generate minute-by-minute data (for 1h and 30min views)
            for (let i = 0; i <= 60; i++) {
                const time = new Date(startTime.getTime() + i * 60000);
                let price = interpolatePrice(i, knownPoints);
                price += (Math.random() - 0.5) * 0.0002;
                price = Math.max(price, targetPrice + 0.00005);
                
                data.minuteData.push({
                    x: time,
                    y: parseFloat(price.toFixed(6))
                });
            }
            
            // Generate high-frequency data every 5 seconds (for 5min views)
            const totalSeconds = 60 * 60; // 1 hour in seconds
            for (let i = 0; i <= totalSeconds; i += 5) {
                const time = new Date(startTime.getTime() + i * 1000);
                const minutePosition = i / 60; // Convert seconds to minute position
                
                let price = interpolatePrice(minutePosition, knownPoints);
                
                // Add more realistic micro-fluctuations for 5-second data
                price += (Math.random() - 0.5) * 0.00008; // Smaller random variations
                price = Math.max(price, targetPrice + 0.00005);
                
                data.highFreqData.push({
                    x: time,
                    y: parseFloat(price.toFixed(6))
                });
            }
            
            return data;
        }

        function interpolatePrice(minute, knownPoints) {
            let before = knownPoints[0];
            let after = knownPoints[knownPoints.length - 1];
            
            for (let i = 0; i < knownPoints.length - 1; i++) {
                if (minute >= knownPoints[i].minute && minute <= knownPoints[i + 1].minute) {
                    before = knownPoints[i];
                    after = knownPoints[i + 1];
                    break;
                }
            }
            
            const ratio = (minute - before.minute) / (after.minute - before.minute);
            return before.price + ratio * (after.price - before.price);
        }

        // Function to find price at specific time
        function getPriceAtTime(timeStr, priceData) {
            const tradeTime = new Date(`2025-08-13T${timeStr}Z`);
            
            // Find closest price point
            let closestPoint = priceData[0];
            let minDiff = Math.abs(closestPoint.x.getTime() - tradeTime.getTime());
            
            for (let point of priceData) {
                const diff = Math.abs(point.x.getTime() - tradeTime.getTime());
                if (diff < minDiff) {
                    minDiff = diff;
                    closestPoint = point;
                }
            }
            
            return closestPoint.y;
        }

        function getPointRadius(trade) {
            switch(trade.size) {
                case 'legendary': return 16;
                case 'huge': return 14;
                case 'large': return 12;
                case 'medium': return 10;
                default: return 8;
            }
        }

        // Create trade points positioned on price line
        function createTradePoints(priceData) {
            const buyYes = [];
            const sellYes = [];
            const buyNo = [];
            const sellNo = [];

            allTrades.forEach(trade => {
                const tradeTime = new Date(`2025-08-13T${trade.time}Z`);
                const priceAtTime = getPriceAtTime(trade.time, priceData);
                
                // Add small vertical offset to prevent overlapping but keep on price line
                const yOffset = (Math.random() - 0.5) * 0.00008; // Smaller offset
                
                const point = {
                    x: tradeTime,
                    y: priceAtTime + yOffset,
                    trade: trade
                };

                // Categorize trades
                if (trade.direction === 'YES' && trade.strategy === 'BUY') {
                    buyYes.push(point);
                } else if (trade.direction === 'YES' && trade.strategy === 'SELL') {
                    sellYes.push(point);
                } else if (trade.direction === 'NO' && trade.strategy === 'BUY') {
                    buyNo.push(point);
                } else {
                    sellNo.push(point);
                }
            });

            // Update stats
            document.getElementById('buyYesCount').textContent = buyYes.length;
            document.getElementById('sellYesCount').textContent = sellYes.length;
            document.getElementById('buyNoCount').textContent = buyNo.length;
            document.getElementById('sellNoCount').textContent = sellNo.length;

            return { buyYes, sellYes, buyNo, sellNo };
        }

        // Generate data
        const priceData = generatePriceData();
        const targetPrice = 0.24072;
        const resolutionPrice = 0.241238;
        const tradePoints = createTradePoints(priceData.minuteData); // Use minute data for initial display

        // Create reference lines
        const startTime = priceData.minuteData[0].x;
        const endTime = priceData.minuteData[priceData.minuteData.length - 1].x;
        const targetLine = [
            { x: startTime, y: targetPrice },
            { x: endTime, y: targetPrice }
        ];
        const resolutionLine = [
            { x: startTime, y: resolutionPrice },
            { x: endTime, y: resolutionPrice }
        ];

        // Custom plugin to draw arrows
        const arrowPlugin = {
            id: 'arrowPlugin',
            afterDatasetsDraw: function(chart, args, options) {
                const { ctx } = chart;
                const chartArea = chart.chartArea;
                
                function drawArrowCircle(x, y, radius, backgroundColor, arrow) {
                    // Skip if outside chart area
                    if (x < chartArea.left || x > chartArea.right || 
                        y < chartArea.top || y > chartArea.bottom) {
                        return;
                    }
                    
                    ctx.save();
                    
                    // Draw white border circle first
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(x, y, radius + 2, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    // Draw colored circle
                    ctx.fillStyle = backgroundColor;
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    // Draw arrow with larger, bolder font
                    ctx.fillStyle = 'white';
                    ctx.font = `bold ${Math.max(16, radius)}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    // Add shadow for better visibility
                    ctx.shadowColor = 'rgba(0,0,0,0.3)';
                    ctx.shadowBlur = 2;
                    ctx.shadowOffsetX = 1;
                    ctx.shadowOffsetY = 1;
                    
                    ctx.fillText(arrow, x, y);
                    
                    ctx.restore();
                }
                
                // Draw arrows for trade datasets (skip first 3 datasets - price lines)
                chart.data.datasets.forEach((dataset, datasetIndex) => {
                    if (datasetIndex < 3) return; // Skip price and reference lines
                    
                    const meta = chart.getDatasetMeta(datasetIndex);
                    if (!meta.data || meta.hidden) return;
                    
                    meta.data.forEach((element, index) => {
                        const trade = dataset.data[index]?.trade;
                        if (!trade) return;
                        
                        const radius = getPointRadius(trade);
                        let backgroundColor, arrow;
                        
                        // Determine color and arrow based on trade type (Apple colors)
                        if (trade.direction === 'YES' && trade.strategy === 'BUY') {
                            backgroundColor = '#30d158'; // Apple Green
                            arrow = '‚Üë';
                        } else if (trade.direction === 'YES' && trade.strategy === 'SELL') {
                            backgroundColor = '#ff3b30'; // Apple Red
                            arrow = '‚Üë';
                        } else if (trade.direction === 'NO' && trade.strategy === 'BUY') {
                            backgroundColor = '#30d158'; // Apple Green
                            arrow = '‚Üì';
                        } else {
                            backgroundColor = '#ff3b30'; // Apple Red
                            arrow = '‚Üì';
                        }
                        
                        drawArrowCircle(element.x, element.y, radius, backgroundColor, arrow);
                    });
                });
            }
        };

        Chart.register(arrowPlugin);

        // Time control state
        let currentPreset = '1h';
        let currentPosition = 0;
        let maxPositions = 1;
        let chart = null;

        // Time control functions
        function setTimePreset(preset) {
            currentPreset = preset;
            currentPosition = 0;
            
            // Update button states
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active');
                if ((preset === '1h' && btn.textContent.includes('1 Hour')) ||
                    (preset === '30min' && btn.textContent.includes('30 Minutes')) ||
                    (preset === '5min' && btn.textContent.includes('5 Minutes'))) {
                    btn.classList.add('active');
                }
            });
            
            // Calculate max positions based on preset
            switch(preset) {
                case '1h':
                    maxPositions = 1;
                    break;
                case '30min':
                    maxPositions = 2;
                    break;
                case '5min':
                    maxPositions = 12;
                    break;
            }
            
            updateChart();
        }

        function navigateTime(direction) {
            const newPosition = currentPosition + direction;
            if (newPosition >= 0 && newPosition < maxPositions) {
                currentPosition = newPosition;
                updateChart();
            }
        }

        function getTimeWindow() {
            const baseStart = new Date('2025-08-13T16:00:00Z');
            const baseEnd = new Date('2025-08-13T17:00:00Z');
            
            let windowStart, windowEnd, intervalMinutes;
            
            switch(currentPreset) {
                case '1h':
                    windowStart = baseStart;
                    windowEnd = baseEnd;
                    intervalMinutes = 60;
                    break;
                case '30min':
                    intervalMinutes = 30;
                    windowStart = new Date(baseStart.getTime() + currentPosition * 30 * 60000);
                    windowEnd = new Date(windowStart.getTime() + 30 * 60000);
                    // Ensure we don't go beyond the base end time
                    if (windowEnd > baseEnd) {
                        windowEnd = baseEnd;
                        windowStart = new Date(windowEnd.getTime() - 30 * 60000);
                    }
                    break;
                case '5min':
                    intervalMinutes = 5;
                    windowStart = new Date(baseStart.getTime() + currentPosition * 5 * 60000);
                    windowEnd = new Date(windowStart.getTime() + 5 * 60000);
                    // Ensure we don't go beyond the base end time
                    if (windowEnd > baseEnd) {
                        windowEnd = baseEnd;
                        windowStart = new Date(windowEnd.getTime() - 5 * 60000);
                    }
                    break;
            }
            
            return { windowStart, windowEnd, intervalMinutes };
        }

        function filterDataByTimeWindow(data, windowStart, windowEnd) {
            return data.filter(point => {
                const pointTime = point.x;
                return pointTime >= windowStart && pointTime <= windowEnd;
            });
        }

        function filterTradesByTimeWindow(trades, windowStart, windowEnd) {
            return trades.filter(trade => {
                const tradeTime = new Date(`2025-08-13T${trade.time}Z`);
                return tradeTime >= windowStart && tradeTime <= windowEnd;
            });
        }

        function updateChart() {
            const { windowStart, windowEnd, intervalMinutes } = getTimeWindow();
            
            // Choose appropriate data resolution based on timeframe
            let sourceData;
            if (currentPreset === '5min') {
                // Use high-frequency data for 5-minute views
                sourceData = allPriceData.highFreqData;
            } else {
                // Use minute data for 1h and 30min views
                sourceData = allPriceData.minuteData;
            }
            
            // Filter price data
            const filteredPriceData = filterDataByTimeWindow(sourceData, windowStart, windowEnd);
            
            // Filter trades
            const filteredTrades = filterTradesByTimeWindow(allTrades, windowStart, windowEnd);
            
            // Recreate trade points with filtered data
            const filteredTradePoints = createTradePointsFromTrades(filteredTrades, filteredPriceData);
            
            // Update chart data
            chart.data.datasets[0].data = filteredPriceData; // Price line
            chart.data.datasets[1].data = [ // Target line
                { x: windowStart, y: targetPrice },
                { x: windowEnd, y: targetPrice }
            ];
            chart.data.datasets[2].data = [ // Resolution line
                { x: windowStart, y: resolutionPrice },
                { x: windowEnd, y: resolutionPrice }
            ];
            chart.data.datasets[3].data = filteredTradePoints.buyYes;
            chart.data.datasets[4].data = filteredTradePoints.sellYes;
            chart.data.datasets[5].data = filteredTradePoints.buyNo;
            chart.data.datasets[6].data = filteredTradePoints.sellNo;
            
            // Update chart scales
            chart.options.scales.x.min = windowStart;
            chart.options.scales.x.max = windowEnd;
            
            // Calculate dynamic Y-axis range based on visible data
            const yScaleConfig = calculateYAxisScale(filteredPriceData, currentPreset);
            chart.options.scales.y.min = yScaleConfig.min;
            chart.options.scales.y.max = yScaleConfig.max;
            
            // Update time unit for X-axis based on timeframe
            updateXAxisTimeUnit(intervalMinutes);
            
            // Update chart
            chart.update('resize');
            
            // Update UI
            updateTimeDisplay(windowStart, windowEnd, intervalMinutes, filteredTrades.length);
            updateNavigationButtons();
        }

        function calculateYAxisScale(priceData, preset) {
            if (priceData.length === 0) {
                return { min: 0.240500, max: 0.243000 };
            }
            
            const prices = priceData.map(d => d.y);
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const priceRange = maxPrice - minPrice;
            
            // Different padding strategies based on timeframe
            let paddingMultiplier;
            switch(preset) {
                case '1h':
                    paddingMultiplier = 0.15; // 15% padding for full hour
                    break;
                case '30min':
                    paddingMultiplier = 0.25; // 25% padding for 30 minutes - more detailed view
                    break;
                case '5min':
                    paddingMultiplier = 0.4; // 40% padding for 5 minutes - most detailed view
                    break;
                default:
                    paddingMultiplier = 0.15;
            }
            
            const padding = Math.max(priceRange * paddingMultiplier, 0.000050); // Minimum padding
            
            return {
                min: minPrice - padding,
                max: maxPrice + padding
            };
        }

        function updateXAxisTimeUnit(intervalMinutes) {
            let timeUnit, displayFormat, stepSize, maxTicksLimit;
            
            if (intervalMinutes >= 60) {
                // 1 hour: show every 10 minutes (minute resolution)
                timeUnit = 'minute';
                displayFormat = 'HH:mm';
                stepSize = 10;
                maxTicksLimit = 6;
            } else if (intervalMinutes >= 30) {
                // 30 minutes: show every 5 minutes (minute resolution)
                timeUnit = 'minute';
                displayFormat = 'HH:mm';
                stepSize = 5;
                maxTicksLimit = 6;
            } else {
                // 5 minutes: show every 30 seconds (5-second resolution)
                timeUnit = 'second';
                displayFormat = 'HH:mm:ss';
                stepSize = 30;
                maxTicksLimit = 10;
            }
            
            chart.options.scales.x.time.unit = timeUnit;
            if (timeUnit === 'second') {
                chart.options.scales.x.time.displayFormats.second = displayFormat;
            } else {
                chart.options.scales.x.time.displayFormats.minute = displayFormat;
            }
            chart.options.scales.x.ticks.stepSize = stepSize;
            chart.options.scales.x.ticks.maxTicksLimit = maxTicksLimit;
        }

        function createTradePointsFromTrades(trades, priceData) {
            const buyYes = [];
            const sellYes = [];
            const buyNo = [];
            const sellNo = [];

            trades.forEach(trade => {
                const tradeTime = new Date(`2025-08-13T${trade.time}Z`);
                const priceAtTime = getPriceAtTime(trade.time, priceData.length > 0 ? priceData : allPriceData.minuteData);
                
                const yOffset = (Math.random() - 0.5) * 0.00008;
                
                const point = {
                    x: tradeTime,
                    y: priceAtTime + yOffset,
                    trade: trade
                };

                if (trade.direction === 'YES' && trade.strategy === 'BUY') {
                    buyYes.push(point);
                } else if (trade.direction === 'YES' && trade.strategy === 'SELL') {
                    sellYes.push(point);
                } else if (trade.direction === 'NO' && trade.strategy === 'BUY') {
                    buyNo.push(point);
                } else {
                    sellNo.push(point);
                }
            });

            return { buyYes, sellYes, buyNo, sellNo };
        }

        function updateTimeDisplay(windowStart, windowEnd, intervalMinutes, tradesCount) {
            const startStr = windowStart.toISOString().substr(11, 5);
            const endStr = windowEnd.toISOString().substr(11, 5);
            
            document.getElementById('timeDisplay').textContent = `${startStr} - ${endStr} UTC`;
            document.getElementById('currentInterval').textContent = `${intervalMinutes} minutes`;
            document.getElementById('tradesVisible').textContent = tradesCount;
            document.getElementById('navigationInfo').textContent = `${currentPosition + 1} of ${maxPositions}`;
            
            // Update price range for visible data
            if (chart && chart.data.datasets[0].data.length > 0) {
                const prices = chart.data.datasets[0].data.map(d => d.y);
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);
                document.getElementById('priceRangeDisplay').textContent = 
                    `$${minPrice.toFixed(6)} - $${maxPrice.toFixed(6)}`;
                
                // Update scale information
                const scaleDescription = getScaleDescription(currentPreset);
                document.getElementById('scaleMode').textContent = scaleDescription;
                
                // Show Y-axis range
                const yMin = chart.options.scales.y.min;
                const yMax = chart.options.scales.y.max;
                if (yMin !== undefined && yMax !== undefined) {
                    const range = yMax - yMin;
                    document.getElementById('yAxisRange').textContent = `¬±${(range/2).toFixed(6)}`;
                }
            }
        }

        function getScaleDescription(preset) {
            switch(preset) {
                case '1h':
                    return 'Overview (15% pad)';
                case '30min':
                    return 'Detailed (25% pad)';
                case '5min':
                    return 'Precision (40% pad)';
                default:
                    return 'Adaptive';
            }
        }

        function updateNavigationButtons() {
            document.getElementById('prevBtn').disabled = currentPosition === 0;
            document.getElementById('nextBtn').disabled = currentPosition === maxPositions - 1;
        }

        // Store original data for filtering
        const allPriceData = priceData;
        
        const ctx = document.getElementById('workingArrowChart').getContext('2d');
        
        chart = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [
                    {
                        label: 'DOGE Price',
                        data: priceData.minuteData,
                        borderColor: '#30d158',
                        backgroundColor: 'rgba(48, 209, 88, 0.1)',
                        borderWidth: 3,
                        pointRadius: 0,
                        pointHoverRadius: 0,
                        tension: 0.4,
                        fill: true,
                        order: 1
                    },
                    {
                        label: 'Target Price',
                        data: targetLine,
                        borderColor: '#ff3b30',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        borderDash: [8, 4],
                        pointRadius: 0,
                        tension: 0,
                        order: 2
                    },
                    {
                        label: 'Resolution',
                        data: resolutionLine,
                        borderColor: '#ff9500',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        borderDash: [4, 2],
                        pointRadius: 0,
                        tension: 0,
                        order: 3
                    },
                    {
                        label: 'BUY YES',
                        data: tradePoints.buyYes,
                        type: 'scatter',
                        backgroundColor: 'transparent',
                        borderColor: 'transparent',
                        pointRadius: 0, // We draw custom arrows
                        showLine: false,
                        order: 4
                    },
                    {
                        label: 'SELL YES',
                        data: tradePoints.sellYes,
                        type: 'scatter',
                        backgroundColor: 'transparent',
                        borderColor: 'transparent',
                        pointRadius: 0,
                        showLine: false,
                        order: 5
                    },
                    {
                        label: 'BUY NO',
                        data: tradePoints.buyNo,
                        type: 'scatter',
                        backgroundColor: 'transparent',
                        borderColor: 'transparent',
                        pointRadius: 0,
                        showLine: false,
                        order: 6
                    },
                    {
                        label: 'SELL NO',
                        data: tradePoints.sellNo,
                        type: 'scatter',
                        backgroundColor: 'transparent',
                        borderColor: 'transparent',
                        pointRadius: 0,
                        showLine: false,
                        order: 7
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'DOGE Trading - High-Frequency 5-Second Resolution',
                        font: {
                            size: 18,
                            weight: 'bold'
                        },
                        padding: 20
                    },
                    legend: {
                        display: false
                    },
                    tooltip: {
                        enabled: true,
                        mode: 'nearest',
                        intersect: false,
                        animation: {
                            duration: 100
                        },
                        backgroundColor: 'rgba(28, 28, 30, 0.95)',
                        titleColor: 'white',
                        bodyColor: 'white',
                        borderColor: '#007aff',
                        borderWidth: 1,
                        cornerRadius: 12,
                        displayColors: false,
                        filter: function(tooltipItem) {
                            return tooltipItem.datasetIndex > 2; // Only show for trade datasets
                        },
                        callbacks: {
                            title: function(context) {
                                const time = new Date(context[0].parsed.x);
                                return `${time.toISOString().substr(11, 8)} UTC`;
                            },
                            label: function(context) {
                                const trade = context.raw.trade;
                                if (trade) {
                                    const arrow = trade.direction === 'YES' ? '‚Üë' : '‚Üì';
                                    const color = trade.strategy === 'BUY' ? 'Green' : 'Red';
                                    return [
                                        `${color} ${arrow} ${trade.direction} ${trade.strategy}`,
                                        `${trade.contracts} contracts`,
                                        `${trade.trader}`,
                                        `$${context.parsed.y.toFixed(6)}`
                                    ];
                                }
                                return '';
                            },
                            afterLabel: function(context) {
                                return ''; // Remove extra spacing
                            }
                        },
                        // Prevent tooltip from getting stuck
                        external: function(context) {
                            const tooltip = context.tooltip;
                            const chartInstance = context.chart;
                            
                            // Hide tooltip when opacity is 0
                            if (tooltip.opacity === 0) {
                                const tooltipEl = document.getElementById('chartjs-tooltip');
                                if (tooltipEl) {
                                    tooltipEl.style.opacity = '0';
                                }
                                return;
                            }
                            
                            // Throttle tooltip updates to prevent freezing
                            if (!chartInstance._tooltipTimeout) {
                                chartInstance._tooltipTimeout = setTimeout(() => {
                                    chartInstance._tooltipTimeout = null;
                                }, 50);
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'minute',
                            displayFormats: {
                                minute: 'HH:mm',
                                second: 'HH:mm:ss'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Time (UTC)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        ticks: {
                            maxTicksLimit: 12,
                            stepSize: 5,
                            font: {
                                size: 10
                            }
                        },
                        // Dynamic range - will be updated by updateChart()
                        min: undefined,
                        max: undefined
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'DOGE Price (USD)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toFixed(6);
                            },
                            maxTicksLimit: 8
                        },
                        // Dynamic scaling - will be updated by updateChart()
                        min: undefined,
                        max: undefined
                    }
                },
                interaction: {
                    mode: 'point',
                    intersect: true,
                    axis: 'xy'
                },
                // Add hover options for better responsiveness
                onHover: (event, activeElements, chart) => {
                    event.native.target.style.cursor = activeElements.length > 0 ? 'pointer' : 'default';
                }
            }
        });
        
        // Initialize display
        const { windowStart, windowEnd } = getTimeWindow();
        updateTimeDisplay(windowStart, windowEnd, 60, allTrades.length);
        updateNavigationButtons();
        
        // Update price range display
        const prices = priceData.minuteData.map(d => d.y);
        const minPrice = Math.min(...prices);
        const maxPrice = Math.max(...prices);
        document.getElementById('priceRangeDisplay').textContent = 
            `$${minPrice.toFixed(6)} - $${maxPrice.toFixed(6)}`;
        
        // Add keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowLeft') {
                navigateTime(-1);
            } else if (event.key === 'ArrowRight') {
                navigateTime(1);
            } else if (event.key === '1') {
                setTimePreset('1h');
            } else if (event.key === '2') {
                setTimePreset('30min');
            } else if (event.key === '3') {
                setTimePreset('5min');
            }
        });
    </script>
</body>
</html>